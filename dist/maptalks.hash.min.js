/*!
 * maptalks.hash v0.1.1
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
/*!
 * requires maptalks@>=0.31.0 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalks=e.maptalks||{},e.maptalks)}(this,function(e,t){"use strict";function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var n=Object.getOwnPropertyNames(t),o=0;o<n.length;o++){var i=n[o],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var o=function(e){function o(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));n._map=t,n._view=n._map.getView(),n.bindEvent(),n.updateView();var i=n.viewToHash(n._view);return n.setHash(i),n}return n(o,e),o.prototype.bindEvent=function(){t.DomUtil.addDomEvent(window,"hashchange",this.onHashChange,this),this._map.on("viewchange",this.onViewChange,this)},o.prototype.setHash=function(e){window.location.hash=e},o.prototype.getHash=function(){return window.location.hash},o.prototype.getView=function(){return this._map.getView()},o.prototype.setView=function(e){e=Object.assign(this._view,e),this._map.setView(e)},o.prototype.updateView=function(){var e=this.getHash(),t=this.hashToView(e);t&&this._map.setView(t)},o.prototype.onHashChange=function(){this.updateView()},o.prototype.onViewChange=function(e){var t=this.viewToHash(e.new);this.setHash(t)},o.prototype.hashToView=function(e){0===e.indexOf("#")&&(e=e.substr(1));var t=e.split("/");if(5!==t.length)return!1;var n=t[0],o=t[1],i=t[2],a=t[3],r=t[4];if(n=parseInt(n),o=parseInt(o),i=parseInt(i),a=parseFloat(a),r=parseFloat(r),!(!isNaN(n)&&n>=1&&n<=21&&!isNaN(o)&&o>=0&&o<=90&&!isNaN(i)&&i>=-180&&i<=180&&!isNaN(a)&&a>=-180&&a<=180&&!isNaN(r)&&r>=-90&&r<=90))return!1;this.setView({center:[a,r],zoom:n,pitch:o,bearing:i})},o.prototype.viewToHash=function(e){var n=Math.max(0,Math.ceil(Math.log(e.zoom)/Math.LN2));return t.StringUtil.replaceVariable("{zoom}/{pitch}/{bearing}/{x}/{y}",{zoom:e.zoom,pitch:parseInt(e.pitch),bearing:parseInt(e.bearing),x:e.center[0].toFixed(n),y:e.center[1].toFixed(n)})},o}(t.Class);e.Hash=o,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.hash v0.1.1, requires maptalks@>=0.31.0.")});