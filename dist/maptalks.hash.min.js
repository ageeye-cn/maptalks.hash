/*!
 * maptalks.hash v0.1.4
 * LICENSE : MIT
 * (c) 2016-2018 maptalks.org
 */
/*!
 * requires maptalks@>=0.31.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var o=n[i],a=Object.getOwnPropertyDescriptor(e,o);a&&a.configurable&&void 0===t[o]&&Object.defineProperty(t,o,a)}}(t,e))}var i=function(t){function i(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));n._map=e,n._updateing=!1,n._view=n._map.getView(),n.bindEvent(),n.updateView();var o=n.viewToHash(n._view);return n.setHash(o),n}return n(i,t),i.prototype.bindEvent=function(){e.DomUtil.addDomEvent(window,"hashchange",this.onHashChange,this),this._map.on("viewchange",this.onViewChange,this)},i.prototype.setHash=function(t){window.location.hash=t},i.prototype.getHash=function(){return window.location.hash},i.prototype.getView=function(){return this._map.getView()},i.prototype.setView=function(t){t=Object.assign(this._view,t),this._map.setView(t)},i.prototype.updateView=function(){var t=this.getHash(),e=this.hashToView(t);e&&this._map.setView(e)},i.prototype.onHashChange=function(){!0!==this._updateing&&this.updateView()},i.prototype.onViewChange=function(t){var e=this,n=this.viewToHash(t.new);this._updateing=!0,this.setHash(n),setTimeout(function(){return e._updateing=!1},0)},i.prototype.hashToView=function(t){0===t.indexOf("#")&&(t=t.substr(1));var e=t.split("/");if(5!==e.length)return!1;var n=e[0],i=e[1],o=e[2],a=e[3],r=e[4];if(n=parseInt(n),i=parseInt(i),o=parseInt(o),a=parseFloat(a),r=parseFloat(r),!(!isNaN(n)&&n>=1&&n<=21&&!isNaN(i)&&i>=0&&i<=90&&!isNaN(o)&&o>=-180&&o<=180&&!isNaN(a)&&a>=-180&&a<=180&&!isNaN(r)&&r>=-90&&r<=90))return!1;this.setView({center:[a,r],zoom:n,pitch:i,bearing:o})},i.prototype.viewToHash=function(t){var n=Math.max(0,Math.ceil(Math.log(t.zoom)/Math.LN2));return e.StringUtil.replaceVariable("{zoom}/{pitch}/{bearing}/{x}/{y}",{zoom:t.zoom,pitch:parseInt(t.pitch),bearing:parseInt(t.bearing),x:t.center[0].toFixed(n+2),y:t.center[1].toFixed(n+2)})},i}(e.Class);t.Hash=i,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.hash v0.1.4, requires maptalks@>=0.31.0.")});